---
title: "Эндпоинты Membership"
---

# Эндпоинты Membership

<div class="article-intro">

Модуль Membership управляет людьми, церквями, группами, домохозяйствами, ролями, разрешениями, формами и настройками. Это крупнейший модуль, предоставляющий основной уровень идентификации и авторизации для всех остальных модулей.

</div>

**Базовый путь:** `/membership`

## Люди

Базовый путь: `/membership/people`

| Метод | Путь | Аутентификация | Разрешение | Описание |
|--------|------|------|------------|-------------|
| GET | `/` | JWT | People.View или Member | Список всех людей церкви |
| GET | `/:id` | JWT | People.View или собственная запись | Получить человека по ID (включает отправки форм) |
| GET | `/ids?ids=` | JWT | People.View или Member | Получить нескольких людей по ID через запятую |
| GET | `/basic?ids=` | JWT | — | Получить базовую информацию (только имя) для нескольких людей |
| GET | `/recent` | JWT | People.View или Member | Недавно добавленные люди |
| GET | `/search?term=&email=` | JWT | People.View или Member | Поиск людей по имени или email |
| GET | `/search/phone?number=` | JWT | People.View или Member | Поиск по номеру телефона |
| GET | `/search/group?groupId=` | JWT | People.View или Member | Получить людей в конкретной группе |
| GET | `/household/:householdId` | JWT | — | Получить всех людей в домохозяйстве |
| GET | `/attendance` | JWT | People.Edit | Загрузить посетителей с фильтрами (campusId, serviceId, serviceTimeId, groupId, categoryName, startDate, endDate) |
| GET | `/timeline?personIds=&groupIds=` | JWT | — | Загрузить данные хронологии для людей и групп |
| GET | `/directory/:id` | JWT | — | Получить человека для просмотра справочника (учитывает настройки видимости) |
| GET | `/claim/:churchId` | JWT | — | Привязать запись о человеке к текущему пользователю в церкви |
| POST | `/` | JWT | People.Edit или EditSelf | Создать или обновить людей (пакетно) |
| POST | `/search` | JWT | People.View или Member | Поиск людей (POST-вариант) |
| POST | `/advancedSearch` | JWT | People.View или Member | Многоусловный поиск (возраст, месяц рождения, статус членства и т.д.) |
| POST | `/loadOrCreate` | Public | — | Найти или создать человека по email. Тело: `{ churchId, email, firstName, lastName }` |
| POST | `/household/:householdId` | JWT | People.Edit | Обновить назначения участников домохозяйства |
| POST | `/public/email` | Public | — | Отправить email человеку. Тело: `{ churchId, personId, subject, body, appName }` |
| POST | `/apiEmails` | Внутренний | — | Загрузить email людей по ID (межсерверный, требует jwtSecret) |
| DELETE | `/:id` | JWT | People.Edit | Удалить человека |

### Пример: Поиск людей

```
GET /membership/people/search?term=John
Authorization: Bearer <token>
```

```json
[
  {
    "id": "abc-123",
    "name": { "first": "John", "last": "Smith" },
    "contactInfo": { "email": "john@example.com" },
    "membershipStatus": "Member"
  }
]
```

### Пример: Создание человека

```
POST /membership/people
Authorization: Bearer <token>

[{ "firstName": "Jane", "lastName": "Doe", "contactInfo": { "email": "jane@example.com" } }]
```

## Пользователи

Базовый путь: `/membership/users`

См. [Аутентификация и разрешения](./authentication) для эндпоинтов входа, регистрации и управления паролями.

| Метод | Путь | Аутентификация | Разрешение | Описание |
|--------|------|------|------------|-------------|
| POST | `/login` | Public | — | Вход (email/пароль, обновление JWT или authGuid) |
| POST | `/register` | Public | — | Регистрация нового пользователя |
| POST | `/forgot` | Public | — | Отправка письма для сброса пароля |
| POST | `/setPasswordGuid` | Public | — | Установка пароля по GUID аутентификации из ссылки в письме |
| POST | `/verifyCredentials` | Public | — | Проверка email/пароля и возврат связанных церквей |
| POST | `/loadOrCreate` | JWT | — | Найти или создать пользователя по email/userId |
| POST | `/setDisplayName` | JWT | — | Обновить имя и фамилию пользователя |
| POST | `/updateEmail` | JWT | — | Изменить email-адрес пользователя |
| POST | `/updatePassword` | JWT | — | Изменить пароль пользователя (мин. 6 символов) |
| POST | `/updateOptedOut` | JWT | — | Установить статус отказа от рассылки для человека |
| GET | `/search?term=` | JWT | Server.Admin | Поиск всех пользователей по имени/email |
| DELETE | `/` | JWT | — | Удалить текущую учётную запись |

## Церкви

Базовый путь: `/membership/churches`

| Метод | Путь | Аутентификация | Разрешение | Описание |
|--------|------|------|------------|-------------|
| GET | `/` | JWT | — | Загрузить все церкви текущего пользователя |
| GET | `/:id` | JWT | — | Получить церковь по ID |
| GET | `/:id/getDomainAdmin` | JWT | — | Получить пользователя-администратора домена для церкви |
| GET | `/:id/impersonate` | JWT | Server.Admin | Имперсонация церкви (только администратор сервера) |
| GET | `/all?term=` | JWT | Server.Admin | Поиск всех церквей (администратор) |
| GET | `/search/?name=` | Public | — | Поиск церквей по названию |
| GET | `/lookup/?subDomain=&id=` | Public | — | Поиск церкви по поддомену или ID |
| POST | `/` | JWT | Settings.Edit | Обновить данные церкви |
| POST | `/add` | JWT | — | Зарегистрировать новую церковь. Обязательные поля: name, address1, city, state, zip, country |
| POST | `/search` | Public | — | Поиск церквей по названию (POST-вариант) |
| POST | `/select` | JWT | — | Выбрать/переключиться на церковь. Тело: `{ churchId }` или `{ subDomain }` |
| POST | `/:id/archive` | JWT | Server.Admin | Архивировать или разархивировать церковь |
| POST | `/byIds` | Public | — | Загрузить несколько церквей по ID |
| DELETE | `/deleteAbandoned` | JWT | Server.Admin | Удалить церкви, заброшенные более 7 дней |

## Группы

Базовый путь: `/membership/groups`

Наследует стандартный CRUD (GET `/`, GET `/:id` из базового класса).

| Метод | Путь | Аутентификация | Разрешение | Описание |
|--------|------|------|------------|-------------|
| GET | `/` | JWT | — | Список всех групп |
| GET | `/:id` | JWT | — | Получить группу по ID |
| GET | `/search?campusId=&serviceId=&serviceTimeId=` | JWT | — | Поиск групп по фильтрам служений |
| GET | `/my` | JWT | — | Получить группы текущего пользователя |
| GET | `/my/:tag` | JWT | — | Получить группы текущего пользователя с фильтром по тегу |
| GET | `/tag/:tag` | JWT | — | Получить все группы с конкретным тегом |
| GET | `/public/:churchId/:id` | Public | — | Получить публичную группу по церкви и ID |
| GET | `/public/:churchId/tag/:tag` | Public | — | Получить публичные группы по тегу |
| GET | `/public/:churchId/label?label=` | Public | — | Получить публичные группы по метке |
| GET | `/public/:churchId/slug/:slug` | Public | — | Получить публичную группу по slug |
| POST | `/` | JWT | Groups.Edit | Создать или обновить группы (автоматически генерирует slug) |
| DELETE | `/:id` | JWT | Groups.Edit | Удалить группу (также удаляет дочерние команды для групп служений) |

## Участники групп

Базовый путь: `/membership/groupmembers`

Наследует стандартный CRUD (GET `/:id`, DELETE `/:id` из базового класса).

| Метод | Путь | Аутентификация | Разрешение | Описание |
|--------|------|------|------------|-------------|
| GET | `/:id` | JWT | GroupMembers.View | Получить участника группы по ID |
| GET | `/` | JWT | GroupMembers.View* | Список участников группы. Фильтр по `?groupId=`, `?groupIds=` или `?personId=`. *Также разрешено, если пользователь состоит в группе или запрашивает собственный personId |
| GET | `/my` | JWT | — | Получить членства в группах текущего пользователя |
| GET | `/basic/:groupId` | JWT | — | Получить базовый список участников для группы |
| GET | `/public/leaders/:churchId/:groupId` | Public | — | Получить лидеров группы (публичный) |
| POST | `/` | JWT | GroupMembers.Edit | Добавить или обновить участников группы |
| DELETE | `/:id` | JWT | GroupMembers.View | Удалить участника группы |

## Домохозяйства

Базовый путь: `/membership/households`

Стандартный CRUD-контроллер.

| Метод | Путь | Аутентификация | Разрешение | Описание |
|--------|------|------|------------|-------------|
| GET | `/` | JWT | — | Список всех домохозяйств |
| GET | `/:id` | JWT | — | Получить домохозяйство по ID |
| POST | `/` | JWT | People.Edit | Создать или обновить домохозяйства |
| DELETE | `/:id` | JWT | People.Edit | Удалить домохозяйство |

## Роли

Базовый путь: `/membership/roles`

| Метод | Путь | Аутентификация | Разрешение | Описание |
|--------|------|------|------------|-------------|
| GET | `/:id` | JWT | Roles.View | Получить роль по ID |
| GET | `/church/:churchId` | JWT | Roles.View | Получить все роли для церкви |
| POST | `/` | JWT | Roles.Edit | Создать или обновить роли |
| DELETE | `/:id` | JWT | Roles.Edit | Удалить роль (также удаляет её разрешения и участников) |

## Участники ролей

Базовый путь: `/membership/rolemembers`

| Метод | Путь | Аутентификация | Разрешение | Описание |
|--------|------|------|------------|-------------|
| GET | `/roles/:id` | JWT | Roles.View | Получить участников для роли. Добавьте `?include=users` для включения данных пользователей |
| POST | `/` | JWT | Roles.Edit | Добавить участников в роль (создаёт пользователя, если email не существует) |
| DELETE | `/:id` | JWT | Roles.View | Удалить участника роли |
| DELETE | `/self/:churchId/:userId` | JWT | — | Удалить себя из церкви |

## Разрешения ролей

Базовый путь: `/membership/rolepermissions`

| Метод | Путь | Аутентификация | Разрешение | Описание |
|--------|------|------|------------|-------------|
| GET | `/roles/:id` | JWT | Roles.View | Получить разрешения для роли (используйте `null` как ID для роли «Все») |
| POST | `/` | JWT | Roles.Edit | Создать или обновить разрешения ролей |
| DELETE | `/:id` | JWT | Roles.Edit | Удалить разрешение роли |

## Разрешения

Базовый путь: `/membership/permissions`

| Метод | Путь | Аутентификация | Разрешение | Описание |
|--------|------|------|------------|-------------|
| GET | `/` | JWT | — | Получить полный список доступных разрешений |

## Формы

Базовый путь: `/membership/forms`

| Метод | Путь | Аутентификация | Разрешение | Описание |
|--------|------|------|------------|-------------|
| GET | `/` | JWT | Forms.Admin или Forms.Edit | Список всех форм (администратор видит все; редакторы видят назначенные + формы для не-членов) |
| GET | `/:id` | JWT | Доступ к форме | Получить форму по ID |
| GET | `/archived` | JWT | Forms.Admin или Forms.Edit | Список архивированных форм |
| GET | `/standalone/:id?churchId=` | JWT | — | Получить автономную форму (ограниченные формы требуют аутентификации) |
| POST | `/` | JWT | Forms.Admin или Forms.Edit | Создать или обновить формы |
| DELETE | `/:id` | JWT | Доступ к форме | Удалить форму |

## Отправки форм

Базовый путь: `/membership/formsubmissions`

| Метод | Путь | Аутентификация | Разрешение | Описание |
|--------|------|------|------------|-------------|
| GET | `/` | JWT | Forms.Admin или Forms.Edit | Список отправок. Фильтр по `?personId=` или `?formId=` |
| GET | `/:id` | JWT | Forms.Admin или Forms.Edit | Получить отправку по ID. Добавьте `?include=form,questions,answers` |
| GET | `/formId/:formId` | JWT | Доступ к форме | Получить все отправки для формы (включает форму, вопросы, ответы) |
| POST | `/` | JWT | — | Отправить ответы формы (обрабатывает ограниченные/неограниченные формы, отправляет email-уведомления) |
| DELETE | `/:id` | JWT | Forms.Admin или Forms.Edit | Удалить отправку и её ответы |

## Вопросы

Базовый путь: `/membership/questions`

| Метод | Путь | Аутентификация | Разрешение | Описание |
|--------|------|------|------------|-------------|
| GET | `/` | JWT | Доступ к форме | Список вопросов для формы. Требуется `?formId=` |
| GET | `/:id` | JWT | Доступ к форме | Получить вопрос по ID |
| GET | `/unrestricted?formId=` | JWT | — | Получить вопросы для неограниченной формы |
| GET | `/sort/:id/up` | JWT | — | Переместить вопрос вверх в порядке сортировки |
| GET | `/sort/:id/down` | JWT | — | Переместить вопрос вниз в порядке сортировки |
| POST | `/` | JWT | Доступ к форме | Создать или обновить вопросы (автоматически назначает порядок сортировки) |
| DELETE | `/:id?formId=` | JWT | Доступ к форме | Удалить вопрос |

## Ответы

Базовый путь: `/membership/answers`

| Метод | Путь | Аутентификация | Разрешение | Описание |
|--------|------|------|------------|-------------|
| GET | `/` | JWT | Forms.Admin или Forms.Edit | Список ответов. Фильтр по `?formSubmissionId=` |
| POST | `/` | JWT | Forms.Admin или Forms.Edit | Создать или обновить ответы |

## Разрешения участников

Базовый путь: `/membership/memberpermissions`

Управляет доступом отдельных участников к конкретным формам.

| Метод | Путь | Аутентификация | Разрешение | Описание |
|--------|------|------|------------|-------------|
| GET | `/:id` | JWT | Доступ к форме | Получить разрешение участника по ID |
| GET | `/member/:id` | JWT | Доступ к форме | Получить все разрешения на формы для участника |
| GET | `/form/:id` | JWT | Доступ к форме | Получить все разрешения участников для формы |
| GET | `/form/:id/my` | JWT | Доступ к форме | Получить разрешение текущего пользователя для формы |
| POST | `/` | JWT | Доступ к форме | Создать или обновить разрешения участников |
| DELETE | `/:id?formId=` | JWT | Доступ к форме | Удалить разрешение участника |
| DELETE | `/member/:id?formId=` | JWT | Доступ к форме | Удалить все разрешения участника на форму |

## Настройки

Базовый путь: `/membership/settings`

| Метод | Путь | Аутентификация | Разрешение | Описание |
|--------|------|------|------------|-------------|
| GET | `/` | JWT | Settings.Edit | Получить все настройки церкви |
| GET | `/public/:churchId` | Public | — | Получить публичные настройки церкви |
| POST | `/` | JWT | Settings.Edit | Сохранить настройки (поддерживает загрузку изображения в base64) |

## Домены

Базовый путь: `/membership/domains`

Наследует стандартный CRUD (GET `/:id`, GET `/`, DELETE `/:id` из базового класса).

| Метод | Путь | Аутентификация | Разрешение | Описание |
|--------|------|------|------------|-------------|
| GET | `/` | JWT | — | Список всех доменов |
| GET | `/:id` | JWT | — | Получить домен по ID |
| GET | `/lookup/:domainName` | JWT | — | Поиск домена по имени |
| GET | `/public/lookup/:domainName` | Public | — | Публичный поиск домена по имени |
| GET | `/health/check` | Public | — | Проверка состояния непроверенных доменов |
| POST | `/` | JWT | Settings.Edit | Создать или обновить домены (запускает обновление Caddy) |
| DELETE | `/:id` | JWT | Settings.Edit | Удалить домен |

## Пользователь-церковь

Базовый путь: `/membership/userchurch`

Управляет связью между пользователями и церквями.

| Метод | Путь | Аутентификация | Разрешение | Описание |
|--------|------|------|------------|-------------|
| GET | `/userid/:userId` | JWT | — | Получить запись пользователь-церковь по ID пользователя |
| GET | `/personid/:personId` | JWT | — | Получить email для привязанного пользователя человека |
| GET | `/user/:userId` | JWT | Server.Admin | Загрузить все церкви для пользователя |
| POST | `/` | JWT | — | Создать связь пользователь-церковь |
| PATCH | `/:userId` | JWT | — | Обновить время последнего доступа и записать вход |
| DELETE | `/record/:userId/:churchId/:personId` | JWT | — | Удалить запись пользователь-церковь |

## Настройки видимости

Базовый путь: `/membership/visibilityPreferences`

| Метод | Путь | Аутентификация | Разрешение | Описание |
|--------|------|------|------------|-------------|
| GET | `/my` | JWT | — | Получить настройки видимости текущего пользователя |
| POST | `/` | JWT | — | Сохранить настройки видимости (видимость адреса, телефона, email) |

## Запросы

Базовый путь: `/membership/query`

| Метод | Путь | Аутентификация | Разрешение | Описание |
|--------|------|------|------------|-------------|
| POST | `/members` | JWT | — | Поиск участников на естественном языке с помощью ИИ. Тело: `{ text, subDomain, siteUrl }` |

## Ошибки клиента

Базовый путь: `/membership/clientErrors`

| Метод | Путь | Аутентификация | Разрешение | Описание |
|--------|------|------|------------|-------------|
| POST | `/` | JWT | — | Записать ошибку на стороне клиента |

## Связанные страницы

- [Аутентификация и разрешения](./authentication) — Процесс входа, JWT, OAuth, модель разрешений
- [Эндпоинты Attendance](./attendance) — Отслеживание служений и посещений
- [Структура модулей](../module-structure) — Паттерны организации кода
